---
title: "conivol: An R package for the (bivariate) chi-bar-squared distribution and conic intrinsic volumes"
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, echo = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "README_figures/"
)
```

This R package provides functions for the chi-bar-squared distribution,
the bivariate chi-bar-squared distribution, and the conic intrinsic volumes.
It supports standard functions for the density/cdf/sampling of the (bivariate)
chi-bar-squared distribution, calculations and known formulas for special classes
of intrinsic volumes of cones, sampling functions for ellipsoidal cones and
general polyhedral cones, as well as functions for estimating intrinsic volumes
either from direct samples of the intrinsic volumes distribution
(in the case of polyhedral cones) or from samples of the corresponding
bivariate chi-bar-squared distribution. The package supports point estimates
as well as Bayesian estimates via JAGS and Stan.

## Installation

You can install `conivol` from github with:

```{r gh-installation, eval = FALSE}
# install.packages("devtools")
devtools::install_github("damelunx/conivol")
```

## Vignettes

The following vignettes introduce the theory of intrinsic volumes, explain the
idea behind the algorithm to reconstruct the intrinsic volumes from samples
of the bivariate chi-bar-squared distribution, and the Bayesian approach
to this reconstruction.

* [Conic intrinsic volumes and (bivariate) chi-bar-squared distribution](../doc/conic-intrinsic-volumes.html):
    introduces conic intrinsic volumes and (bivariate) chi-bar-squared distributions,
    as well as the computations involving polyhedral cones
* [Estimating conic intrinsic volumes via EM algorithm](../doc/estim-conic-intrinsic-volumes-with-EM.html):
    describes the details of the algorithm for finding the intrinsic volumes of closed
    convex cones from samples of the associated bivariate chi-bar-squared distribution
* [Bayesian estimates for conic intrinsic volumes](../doc/bayesian.html):
    describes the Bayesian approach for reconstructing intrinsic volumes
    from sampling data, which can either be samples from the intrinsic
    volumes distribution (in the case of polyhedral cones), or from the
    bivariate chi-bar-squared distribution, and which can be with or without
    enforcing log-concavity of the intrinsic volumes

## Functions

In the following we list up the functions that are exported in the package
(sorted by context), and include some examples to illustrate their use.
See the above vignettes for more details about the underlying theory and algorithms.

### (Bivariate) Chi-bar-squared distribution:

`conivol` provides the standard support of the distributions (chi-bar-squared
and bivariate chi-bar-squared) in the form of functions for the densities,
cumulative distribution functions, and sampling methods:

* `dchibarsq`, `dbichibarsq`: evaluate the densities of (bivariate) chi-bar-squared
    distributions,
* `pchibarsq`, `pbichibarsq`: evaluate the dumulative distribution functions of
    (bivariate) chi-bar-squared distributions,
* `rchibarsq`, `rbichibarsq`: produce samples of the (bivariate) chi-bar-squared
    distributions.

```{r load-pkgs, include=FALSE}
library(conivol)
library(tidyverse)
```

**Usage:**
```{r ex-biv-chi-bar-sq}
# vector of weights
v <- rep(1,8)/8

# points to evaluate densities/cdfs (in the bavariate case two-column matrix)
x <- 0:10
xmat <- matrix(c(0:10,0:10),ncol=2)

# evaluate densities
dchibarsq(x, v)
dbichibarsq(xmat, v)

# evaluate cdfs
pchibarsq(x, v)
pbichibarsq(xmat, v)

# draw samples
rchibarsq(10,v)
rbichibarsq(10,v)
```

### Special classes of cones:

Some special classes of cones admit a direct computation of intrinsic volumes
or a particularly simple sampling procedure for the bivariate chi-bar-squared
distribution. These situations are covered by the following functions:

* `prod_ivols`: computes the intrinsic volumes of a product cone
    by convolving the intrinsic volumes of its elements,
* `circ_ivols`: computes the intrinsic volumes of (a product of) circular cones,
* `ellips_semiax`, `ellips_rbichibarsq`: computes the semiaxes / produces samples
    from the bivariate chi-bar-squared distribution of an ellipsoidal cone,
* `weyl_matrix`, `weyl_ivols`: computes a matrix representation / computes the
    intrinsic volumes of (a product of) Weyl chambers.

It is worth pointing out that with the class of direct product of Weyl chambers
we obtain an interesting family of cones for which we have exact formulas;
the same remark applies to the family of direct products of circular cones.
We will use these functions to test the reconstruction algorithms.
Ellipsoidal cones do not admit (simple) direct calculations of its intrinsic
volumes.

**Usage:**
```{r ex-spec-cones}
# the intrinsic volumes of the 4-dimensional circular cone of radius pi/4 a.k.a. Lorentz cone
circ_ivols(4,pi/4)

# the intrinsic volumes of the direct product of two 4-dimensional Lorentz cones
prod_ivols( list(circ_ivols(4,pi/4), circ_ivols(4,pi/4)) )

# computing the semiaxes of the ellipsoidal cone given by the linear image of the Lorentz cone
A <- matrix(sample(1:25),5,5)
ellips_semiax(A)

# draw samples of the bivariate chi-bar-squared distribution of the ellipsoidal cone
ellips_rbichibarsq(10, A)

# compute the matrix of the product of some Weyl chambers
weyl_matrix( rep(3,4), c("BC","BCp","D","Dp"), product=TRUE)

# compute the corresponding intrinsic volumes of the above cone
weyl_ivols( rep(3,4), c("BC","BCp","D","Dp"), product=TRUE)
```

### General polyhedral cones:
* `polyh_reduce_gen`, `polyh_reduce_ineq`: compute a reduced representation
    of a polyhedral cone given by generators / inequalities
* `polyh_rivols_gen`, `polyh_rivols_ineq`: produce samples from the intrinsic
    volumes distribution of a polyhedral cone given by generators / inequalities
* `polyh_rbichibarsq_gen`, `polyh_rbichibarsq_ineq`: produce samples from the
    bivariate chi-bar-squared distribution with weights given by the conic
    intrinsic volumes of a polyhedral cone given by generators / inequalities
* `polyh_bayes`: generates functions for computing quantiles of marginals
    of the posterior distribution and for sampling from the posterior distribution,
    given samples of the intrinsic volumes distribution (based on analytic solution)
* `polyh_stan`: generates inputs for Stan (data list and model string or external file)
    for sampling from the posterior distribution, given samples of the
    intrinsic volumes distribution using a model that naturally implies log-concavity
    (and cannot be solved analytically)

**Usage:**
```{r ex-polyh}
# example
```

### Estimating the weights of the bivariate chi-bar-squared distribution:
* `estim_statdim_var`: estimates the statistical dimension and the variance
    of the intrinsic volumes from samples of the corresponding bivariate
    chi-bar-squared distribution
* `init_ivols`: find an initial estimate of the weights, potentially based on
    first and/or second moment
* `loglike_ivols`: compute the log-likelihood of a weight vector for specific sample data
* `prepare_em`: evaluates the sample data of the bivariate chi-bar-squared
    data (find the corresponding chi-squared density values)
* `estim_em`: produces EM-type iterates that may or may not converge to the
    maximum likelihood estimate for the weights of the bivariate chi-bar-squared
    distribution from sample data
* `estim_jags`, `estim_stan`: generates inputs for JAGS / Stan (data list and model
    string or external file) for sampling from the posterior distribution
    of the intrinsic volumes, given samples of the bivariate chi-bar-squared distribution

**Usage:**
```{r ex-reconstr}
# example
```

