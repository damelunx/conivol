<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>A package for the (bivariate) chi-bar-squared distribution and conic intrinsic volumes • conivol</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/yeti/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="jquery.sticky-kit.min.js"></script><script src="pkgdown.js"></script><meta property="og:title" content="A package for the (bivariate) chi-bar-squared distribution and conic intrinsic volumes">
<meta property="og:description" content="The conivol package provides functions for the chi-bar-squared distribution, the bivariate chi-bar-squared distribution, and the conic intrinsic volumes.">
<meta property="og:image" content="http://damelunx.github.io/conivol/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">conivol</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li>
  <a href="reference/conivol.html">Overview</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="articles/conic-intrinsic-volumes.html">Conic intrinsic volumes and (bivariate) chi-bar-squared distribution</a>
    </li>
    <li>
      <a href="articles/estim-conic-intrinsic-volumes-with-EM.html">Estimating conic intrinsic volumes from bivariate chi-bar-squared data</a>
    </li>
    <li>
      <a href="articles/bayesian.html">Bayesian estimates for conic intrinsic volumes</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="reference/index.html">
    <span class="fa fa-file-code-o"></span>
     
    functions
  </a>
</li>
<li>
  <a href="https://github.com/damelunx/conivol">
    <span class="fa fa-github fa-lg"></span>
     
    github
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    

    
    
<div class="contents">
<!-- README.md is generated from README.Rmd. Please edit that file -->
<div id="conivol-an-r-package-for-the-bivariate-chi-bar-squared-distribution-and-conic-intrinsic-volumes" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#conivol-an-r-package-for-the-bivariate-chi-bar-squared-distribution-and-conic-intrinsic-volumes" class="anchor"></a>conivol:<img src="logo.png" width="125" height="125" align="right"> An R package for the (bivariate) chi-bar-squared distribution and conic intrinsic volumes</h1></div>
<p>This R package provides functions for the chi-bar-squared distribution, the bivariate chi-bar-squared distribution, and the conic intrinsic volumes. It supports standard functions for the density/cdf/sampling of the (bivariate) chi-bar-squared distribution, calculations and known formulas for special classes of intrinsic volumes of cones, sampling functions for ellipsoidal cones and general polyhedral cones, as well as functions for estimating intrinsic volumes either from direct samples of the intrinsic volumes distribution (in the case of polyhedral cones) or from samples of the corresponding bivariate chi-bar-squared distribution. The package supports point estimates as well as Bayesian estimates via JAGS and Stan.</p>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<p>You can install <code>conivol</code> from github with:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># install.packages("devtools")</span>
devtools::<span class="kw">install_github</span>(<span class="st">"damelunx/conivol"</span>)</code></pre></div>
</div>
<div id="code-documentation" class="section level2">
<h2 class="hasAnchor">
<a href="#code-documentation" class="anchor"></a>Code &amp; documentation</h2>
<ul>
<li>Source code: <a href="http://github.com/damelunx/conivol">github.com/damelunx/conivol</a>
</li>
<li>Manual: <a href="http://damelunx.github.io/conivol">damelunx.github.io/conivol</a>
</li>
</ul>
<p><strong>See also:</strong></p>
<ul>
<li>
<code>symconivol</code> package: <a href="http://damelunx.github.io/symconivol">damelunx.github.io/symconivol</a>
</li>
</ul>
</div>
<div id="vignettes" class="section level2">
<h2 class="hasAnchor">
<a href="#vignettes" class="anchor"></a>Vignettes</h2>
<p>The following vignettes introduce the theory of intrinsic volumes, explain the idea behind the algorithm to reconstruct the intrinsic volumes from samples of the bivariate chi-bar-squared distribution, and the Bayesian approach to this reconstruction:</p>
<ul>
<li>
<a href="articles/conic-intrinsic-volumes.html">Conic intrinsic volumes and (bivariate) chi-bar-squared distribution</a>: introduces conic intrinsic volumes and (bivariate) chi-bar-squared distributions, as well as the computations involving polyhedral cones,</li>
<li>
<a href="articles/estim-conic-intrinsic-volumes-with-EM.html">Estimating conic intrinsic volumes from bivariate chi-bar-squared data</a>: describes the details of the algorithm for finding the intrinsic volumes of closed convex cones from samples of the associated bivariate chi-bar-squared distribution,</li>
<li>
<a href="articles/bayesian.html">Bayesian estimates for conic intrinsic volumes</a>: describes the Bayesian approach for reconstructing intrinsic volumes from sampling data, which can either be samples from the intrinsic volumes distribution (in the case of polyhedral cones), or from the bivariate chi-bar-squared distribution, and which can be with or without enforcing log-concavity of the intrinsic volumes.</li>
</ul>
</div>
<div id="functions" class="section level2">
<h2 class="hasAnchor">
<a href="#functions" class="anchor"></a>Functions</h2>
<p>In the following we list up the functions that are exported in the package (sorted by context), and include some examples to illustrate their use. See the above vignettes for more details about the underlying theory and algorithms.</p>
<div id="bivariate-chi-bar-squared-distribution" class="section level3">
<h3 class="hasAnchor">
<a href="#bivariate-chi-bar-squared-distribution" class="anchor"></a>(Bivariate) Chi-bar-squared distribution:</h3>
<p><code>conivol</code> provides the standard support of the distributions (chi-bar-squared and bivariate chi-bar-squared) in the form of functions for the densities, cumulative distribution functions, and sampling methods:</p>
<ul>
<li>
<code>dchibarsq</code>, <code>dbichibarsq</code>: evaluate the densities of (bivariate) chi-bar-squared distributions,</li>
<li>
<code>pchibarsq</code>, <code>pbichibarsq</code>: evaluate the dumulative distribution functions of (bivariate) chi-bar-squared distributions,</li>
<li>
<code>rchibarsq</code>, <code>rbichibarsq</code>: produce samples of the (bivariate) chi-bar-squared distributions.</li>
</ul>
<p><strong>Usage:</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># vector of weights</span>
v &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="dv">1</span>,<span class="dv">8</span>)/<span class="dv">8</span>

<span class="co"># points to evaluate densities/cdfs (in the bavariate case two-column matrix)</span>
x &lt;-<span class="st"> </span><span class="dv">0</span>:<span class="dv">10</span>
xmat &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">0</span>:<span class="dv">10</span>,<span class="dv">0</span>:<span class="dv">10</span>),<span class="dt">ncol=</span><span class="dv">2</span>)

<span class="co"># evaluate densities</span>
<span class="kw"><a href="reference/chibarsq.html">dchibarsq</a></span>(x, v)
<span class="co">#&gt;  [1]        Inf 0.13419199 0.12061209 0.10708571 0.09155903 0.07548244</span>
<span class="co">#&gt;  [7] 0.06030318 0.04691767 0.03569914 0.02665556 0.01958501</span>
<span class="kw"><a href="reference/bichibarsq.html">dbichibarsq</a></span>(xmat, v)
<span class="co">#&gt;  [1]          Inf 0.0175809440 0.0182933272 0.0123633200 0.0070024293</span>
<span class="co">#&gt;  [6] 0.0036001390 0.0017409915 0.0008070907 0.0003627570 0.0001592392</span>
<span class="co">#&gt; [11] 0.0000686107</span>

<span class="co"># evaluate cdfs</span>
<span class="kw"><a href="reference/chibarsq.html">pchibarsq</a></span>(x, v)
<span class="co">#&gt;  [1] 0.1250000 0.3027630 0.4297465 0.5437900 0.6432281 0.7267271 0.7944988</span>
<span class="co">#&gt;  [8] 0.8479373 0.8890605 0.9200628 0.9430303</span>
<span class="kw"><a href="reference/bichibarsq.html">pbichibarsq</a></span>(xmat, v)
<span class="co">#&gt;  [1] 0.000000000 0.001292866 0.010039908 0.028749442 0.055055648</span>
<span class="co">#&gt;  [6] 0.085009193 0.115062662 0.142780036 0.166851524 0.186835988</span>
<span class="co">#&gt; [11] 0.202856633</span>

<span class="co"># draw samples</span>
<span class="kw"><a href="reference/chibarsq.html">rchibarsq</a></span>(<span class="dv">10</span>,v)
<span class="co">#&gt;  [1]  7.7411471  8.7668777  0.3549214  1.3508474  0.0000000  2.2773917</span>
<span class="co">#&gt;  [7]  4.8770173  4.3152972  3.2813015 10.3182881</span>
<span class="kw"><a href="reference/bichibarsq.html">rbichibarsq</a></span>(<span class="dv">10</span>,v)
<span class="co">#&gt;             [,1]      [,2]</span>
<span class="co">#&gt;  [1,]  1.5583268  3.209531</span>
<span class="co">#&gt;  [2,]  0.0000000  8.541466</span>
<span class="co">#&gt;  [3,]  2.7387227  3.374385</span>
<span class="co">#&gt;  [4,]  8.4134752  2.554337</span>
<span class="co">#&gt;  [5,]  0.0000000 22.281228</span>
<span class="co">#&gt;  [6,]  0.3001942  5.802075</span>
<span class="co">#&gt;  [7,]  3.2969870  3.447288</span>
<span class="co">#&gt;  [8,]  2.5710089 11.537947</span>
<span class="co">#&gt;  [9,] 11.9151572  2.353439</span>
<span class="co">#&gt; [10,]  7.7575697  0.000000</span></code></pre></div>
</div>
<div id="special-classes-of-cones" class="section level3">
<h3 class="hasAnchor">
<a href="#special-classes-of-cones" class="anchor"></a>Special classes of cones:</h3>
<p>Some special classes of cones admit a direct computation of intrinsic volumes or a particularly simple sampling procedure for the bivariate chi-bar-squared distribution. These situations are covered by the following functions:</p>
<ul>
<li>
<code>prod_ivols</code>: computes the intrinsic volumes of a product cone by convolving the intrinsic volumes of its elements,</li>
<li>
<code>circ_ivols</code>: computes the intrinsic volumes of (a product of) circular cones,</li>
<li>
<code>ellips_semiax</code>, <code>ellips_rbichibarsq</code>: computes the semiaxes / produces samples from the bivariate chi-bar-squared distribution of an ellipsoidal cone,</li>
<li>
<code>weyl_matrix</code>, <code>weyl_ivols</code>: computes a matrix representation / computes the intrinsic volumes of (a product of) Weyl chambers.</li>
</ul>
<p>It is worth pointing out that with the class of direct product of Weyl chambers we obtain an interesting family of cones for which we have exact formulas; the same remark applies to the family of direct products of circular cones. We will use these functions to test the reconstruction algorithms. Ellipsoidal cones do not admit (simple) direct calculations of its intrinsic volumes.</p>
<p><strong>Usage:</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># the intrinsic volumes of the 4-dimensional circular cone of radius pi/4 a.k.a. Lorentz cone</span>
<span class="kw"><a href="reference/circ_ivols.html">circ_ivols</a></span>(<span class="dv">4</span>,pi/<span class="dv">4</span>)
<span class="co">#&gt; [1] 0.09084506 0.25000000 0.31830989 0.25000000 0.09084506</span>

<span class="co"># the intrinsic volumes of the direct product of two 4-dimensional Lorentz cones</span>
<span class="kw"><a href="reference/prod_ivols.html">prod_ivols</a></span>( <span class="kw">list</span>(<span class="kw"><a href="reference/circ_ivols.html">circ_ivols</a></span>(<span class="dv">4</span>,pi/<span class="dv">4</span>), <span class="kw"><a href="reference/circ_ivols.html">circ_ivols</a></span>(<span class="dv">4</span>,pi/<span class="dv">4</span>)) )
<span class="co">#&gt; [1] 0.008252824 0.045422528 0.120333759 0.204577472 0.242826832 0.204577472</span>
<span class="co">#&gt; [7] 0.120333759 0.045422528 0.008252824</span>

<span class="co"># computing the semiaxes of the ellipsoidal cone given by the linear image of the Lorentz cone</span>
A &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">sample</span>(<span class="dv">1</span>:<span class="dv">25</span>),<span class="dv">5</span>,<span class="dv">5</span>)
<span class="kw"><a href="reference/ellips_semiax.html">ellips_semiax</a></span>(A)
<span class="co">#&gt; [1] 21.989356  6.521781  4.501647  2.815021</span>

<span class="co"># draw samples of the bivariate chi-bar-squared distribution of the ellipsoidal cone</span>
<span class="kw"><a href="reference/ellips_rbichibarsq.html">ellips_rbichibarsq</a></span>(<span class="dv">10</span>, A)
<span class="co">#&gt; $semiax</span>
<span class="co">#&gt; [1] 21.989356  6.521781  4.501647  2.815021</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $samples</span>
<span class="co">#&gt;           [,1]          [,2]</span>
<span class="co">#&gt;  [1,] 5.351988  4.075967e+00</span>
<span class="co">#&gt;  [2,] 4.849587  1.995710e+00</span>
<span class="co">#&gt;  [3,] 2.621234  3.065948e+00</span>
<span class="co">#&gt;  [4,] 1.073909  8.456273e-01</span>
<span class="co">#&gt;  [5,] 9.990704  8.537987e-01</span>
<span class="co">#&gt;  [6,] 2.272224  1.054433e+00</span>
<span class="co">#&gt;  [7,] 9.112687  3.478196e-01</span>
<span class="co">#&gt;  [8,] 6.313790 -7.648993e-12</span>
<span class="co">#&gt;  [9,] 4.292650  2.856537e-02</span>
<span class="co">#&gt; [10,] 4.479650 -2.081742e-07</span>

<span class="co"># compute the matrix of the product of some Weyl chambers</span>
<span class="kw"><a href="reference/weyl_matrix.html">weyl_matrix</a></span>( <span class="kw">rep</span>(<span class="dv">3</span>,<span class="dv">4</span>), <span class="kw">c</span>(<span class="st">"BC"</span>,<span class="st">"BCp"</span>,<span class="st">"D"</span>,<span class="st">"Dp"</span>), <span class="dt">product=</span><span class="ot">TRUE</span>)
<span class="co">#&gt;       [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9] [,10] [,11] [,12]</span>
<span class="co">#&gt;  [1,]   -1    1    0    0    0    0    0    0    0     0     0     0</span>
<span class="co">#&gt;  [2,]    0   -1    1    0    0    0    0    0    0     0     0     0</span>
<span class="co">#&gt;  [3,]    0    0   -1    0    0    0    0    0    0     0     0     0</span>
<span class="co">#&gt;  [4,]    0    0    0    1    0    0    0    0    0     0     0     0</span>
<span class="co">#&gt;  [5,]    0    0    0    1    1    0    0    0    0     0     0     0</span>
<span class="co">#&gt;  [6,]    0    0    0    1    1    1    0    0    0     0     0     0</span>
<span class="co">#&gt;  [7,]    0    0    0    0    0    0   -1    1    0     0     0     0</span>
<span class="co">#&gt;  [8,]    0    0    0    0    0    0   -1   -1    1     0     0     0</span>
<span class="co">#&gt;  [9,]    0    0    0    0    0    0    0    0   -1     0     0     0</span>
<span class="co">#&gt; [10,]    0    0    0    0    0    0    0    0    0     1    -1     0</span>
<span class="co">#&gt; [11,]    0    0    0    0    0    0    0    0    0     1     1     0</span>
<span class="co">#&gt; [12,]    0    0    0    0    0    0    0    0    0     1     1     1</span>

<span class="co"># compute the corresponding intrinsic volumes of the above cone</span>
<span class="kw"><a href="reference/weyl_ivols.html">weyl_ivols</a></span>( <span class="kw">rep</span>(<span class="dv">3</span>,<span class="dv">4</span>), <span class="kw">c</span>(<span class="st">"BC"</span>,<span class="st">"BCp"</span>,<span class="st">"D"</span>,<span class="st">"Dp"</span>), <span class="dt">product=</span><span class="ot">TRUE</span>)
<span class="co">#&gt;  [1] 6.781684e-05 1.245569e-03 9.691780e-03 4.227024e-02 1.151364e-01</span>
<span class="co">#&gt;  [6] 2.064842e-01 2.502080e-01 2.064842e-01 1.151364e-01 4.227024e-02</span>
<span class="co">#&gt; [11] 9.691780e-03 1.245569e-03 6.781684e-05</span></code></pre></div>
</div>
<div id="general-polyhedral-cones" class="section level3">
<h3 class="hasAnchor">
<a href="#general-polyhedral-cones" class="anchor"></a>General polyhedral cones:</h3>
<p>For polyhedral cones we can sample directly from the intrinsic volumes distribution by determining the dimension of the face containing the projection of a random Gaussian vector. Since the result of such a sampling is just a draw from the multinomial distribution, the Bayesian posterior for a Dirichlet prior can be computed analytically. If a more complicated model is used that enforces log-concavity of the intrinsic volumes, then this cannot be solved analytically, but its posterior distribution can still be sampled from via Monte-Carlo methods. The following functions support these computations:</p>
<ul>
<li>
<code>polyh_reduce_gen</code>, <code>polyh_reduce_ineq</code>: compute a reduced representation of a polyhedral cone given by generators / inequalities,</li>
<li>
<code>polyh_rivols_gen</code>, <code>polyh_rivols_ineq</code>: produce samples from the intrinsic volumes distribution of a polyhedral cone given by generators / inequalities,</li>
<li>
<code>polyh_rbichibarsq_gen</code>, <code>polyh_rbichibarsq_ineq</code>: produce samples from the bivariate chi-bar-squared distribution with weights given by the conic intrinsic volumes of a polyhedral cone given by generators / inequalities,</li>
<li>
<code>polyh_bayes</code>: generates functions for computing quantiles of marginals of the posterior distribution and for sampling from the posterior distribution, given samples of the intrinsic volumes distribution (based on analytic solution),</li>
<li>
<code>polyh_stan</code>: generates inputs for Stan (data list and model string or external file) for sampling from the posterior distribution, given samples of the intrinsic volumes distribution using a model that naturally implies log-concavity (and cannot be solved analytically).</li>
</ul>
<p><strong>Usage:</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># finding the reduced form of some odd polyhedral cone</span>
A &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dv">1</span>:<span class="dv">35</span>, <span class="dv">5</span>, <span class="dv">7</span>)
<span class="kw"><a href="reference/polyh_reduce.html">polyh_reduce_gen</a></span>(A)
<span class="co">#&gt; $dimC</span>
<span class="co">#&gt; [1] 2</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $linC</span>
<span class="co">#&gt; [1] 0</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $QL</span>
<span class="co">#&gt; [1] NA</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $QC</span>
<span class="co">#&gt;            [,1]       [,2]</span>
<span class="co">#&gt; [1,] -0.4084634 -0.6581472</span>
<span class="co">#&gt; [2,] -0.4274357 -0.3424890</span>
<span class="co">#&gt; [3,] -0.4464080 -0.0268309</span>
<span class="co">#&gt; [4,] -0.4653803  0.2888272</span>
<span class="co">#&gt; [5,] -0.4843526  0.6044853</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $A_reduced</span>
<span class="co">#&gt;           [,1]       [,2]</span>
<span class="co">#&gt; [1,] -6.885843 -73.847043</span>
<span class="co">#&gt; [2,]  2.754118  -1.270518</span>
<span class="kw"><a href="reference/polyh_reduce.html">polyh_reduce_ineq</a></span>(A)
<span class="co">#&gt; $dimC</span>
<span class="co">#&gt; [1] 5</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $linC</span>
<span class="co">#&gt; [1] 3</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $QL</span>
<span class="co">#&gt; [1] NA</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $QC</span>
<span class="co">#&gt;            [,1]       [,2]</span>
<span class="co">#&gt; [1,] -0.4084634 -0.6581472</span>
<span class="co">#&gt; [2,] -0.4274357 -0.3424890</span>
<span class="co">#&gt; [3,] -0.4464080 -0.0268309</span>
<span class="co">#&gt; [4,] -0.4653803  0.2888272</span>
<span class="co">#&gt; [5,] -0.4843526  0.6044853</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $A_reduced</span>
<span class="co">#&gt;           [,1]       [,2]</span>
<span class="co">#&gt; [1,] -6.885843 -73.847043</span>
<span class="co">#&gt; [2,]  2.754118  -1.270518</span>

<span class="co"># sampling from the intrinsic volumes distributions</span>
<span class="co"># (setting reduce to FALSE since otherwise polyh_reduce_*** would be called)</span>
<span class="kw"><a href="reference/polyh_rivols.html">polyh_rivols_gen</a></span>(<span class="dv">10</span>, A, <span class="dt">reduce=</span><span class="ot">FALSE</span>)
<span class="co">#&gt; $samples</span>
<span class="co">#&gt;  [1] 0 1 1 1 1 0 0 0 0 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $multsamp</span>
<span class="co">#&gt; [1] 5 5 0 0 0 0</span>
<span class="kw"><a href="reference/polyh_rivols.html">polyh_rivols_ineq</a></span>(<span class="dv">10</span>, A, <span class="dt">reduce=</span><span class="ot">FALSE</span>)
<span class="co">#&gt; $samples</span>
<span class="co">#&gt;  [1] 5 5 4 5 3 4 5 4 4 4</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $multsamp</span>
<span class="co">#&gt; [1] 0 0 0 1 5 4</span>

<span class="co"># computing the Bayesian posterior with Dirichlet prior (analytically solvable)</span>
<span class="co"># we sample from a product of Weyl chambers to have the true values at hand</span>

W      &lt;-<span class="st"> </span><span class="kw"><a href="reference/weyl_matrix.html">weyl_matrix</a></span>( <span class="kw">rep</span>(<span class="dv">4</span>,<span class="dv">3</span>), <span class="kw">c</span>(<span class="st">"BC"</span>,<span class="st">"D"</span>,<span class="st">"Dp"</span>), <span class="dt">product=</span><span class="ot">TRUE</span>)
v_true &lt;-<span class="st"> </span><span class="kw"><a href="reference/weyl_ivols.html">weyl_ivols</a></span>(  <span class="kw">rep</span>(<span class="dv">4</span>,<span class="dv">3</span>), <span class="kw">c</span>(<span class="st">"BC"</span>,<span class="st">"D"</span>,<span class="st">"Dp"</span>), <span class="dt">product=</span><span class="ot">TRUE</span>)
out &lt;-<span class="st"> </span><span class="kw"><a href="reference/polyh_rivols.html">polyh_rivols_ineq</a></span>(<span class="fl">1e3</span>, W)

<span class="co"># evaluate posterior distribution</span>
bayes_est &lt;-<span class="st"> </span><span class="kw"><a href="reference/polyh_bayes.html">polyh_bayes</a></span>( out$multsamp, out$dimC, out$linC )

<span class="co"># compare posterior median with true values</span>
v_est_med &lt;-<span class="st"> </span>bayes_est$<span class="kw">post_marg_quant</span>(<span class="dv">0</span>:<span class="dv">12</span>,<span class="fl">0.5</span>)
v_est_med /<span class="st"> </span>v_true
<span class="co">#&gt;  [1] 2.3816378 0.7750107 0.7278206 1.0391228 0.9785720 0.9422667 1.0150368</span>
<span class="co">#&gt;  [8] 1.0757495 1.2287800 1.3051012 0.6557067 0.1108293 1.4777201</span>
<span class="kw">sum</span>( (v_est_med-v_true)^<span class="dv">2</span> )
<span class="co">#&gt; [1] 0.0005220288</span>

<span class="co"># display boxplot of posterior distribution, overlayed with true values</span>
data &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>( bayes_est$<span class="kw">post_samp</span>(<span class="fl">1e4</span>) )
<span class="kw">colnames</span>(data) &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="kw">rep</span>(<span class="st">"V"</span>,<span class="dv">13</span>),<span class="kw">as.character</span>(<span class="dv">0</span>:<span class="dv">12</span>))
<span class="kw">boxplot</span>( value~key, <span class="kw">gather</span>( data, <span class="dt">factor_key=</span><span class="ot">TRUE</span> ) )
<span class="kw">lines</span>(<span class="dv">1+0</span>:<span class="dv">12</span>, v_true, <span class="dt">col=</span><span class="st">"red"</span>)
<span class="kw">lines</span>(<span class="dv">1+0</span>:<span class="dv">12</span>, v_est_med, <span class="dt">col=</span><span class="st">"blue"</span>)</code></pre></div>
<p><img src="README_figures/ex-polyh-1.png" width="768" style="display: block; margin: auto;"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># the Bayesian approach using a model that induces log-concavity works with</span>
<span class="co"># the HMC sampler Stan; see the vignette on the Bayesian estimates for an example</span></code></pre></div>
</div>
<div id="estimating-the-weights-of-the-bivariate-chi-bar-squared-distribution" class="section level3">
<h3 class="hasAnchor">
<a href="#estimating-the-weights-of-the-bivariate-chi-bar-squared-distribution" class="anchor"></a>Estimating the weights of the bivariate chi-bar-squared distribution:</h3>
<p>When the cone is nonpolyhedral or when sampling from the intrinsic volumes distribution is infeasible (due to high dimensions or numerical issues), one may still try to recover the intrinsic volumes from samples of the bivariate chi-bar-squared distribution. The following functions support estimating the first two moments of the intrinsic volumes distribution and finding coarse estimates from these moments, and finding the maximum likelihood estimate via expectation-maximization. <code>conivol</code> also supports using the samplers JAGS and Stan to analyze the posterior distribution of the intrinsic volumes; see the vignette on Bayes estimates for illustrations of the usage of these functions.</p>
<ul>
<li>
<code>estim_statdim_var</code>: estimates the statistical dimension and the variance of the intrinsic volumes from samples of the corresponding bivariate chi-bar-squared distribution,</li>
<li>
<code>init_ivols</code>: finds an initial estimate of the weights, potentially based on first and/or second moment,</li>
<li>
<code>loglike_ivols</code>: computes the log-likelihood of a weight vector for specific sample data</li>
<li>
<code>prepare_em</code>: evaluates the sample data of the bivariate chi-bar-squared data (find the corresponding chi-squared density values),</li>
<li>
<code>estim_em</code>: produces EM-type iterates that may or may not converge to the maximum likelihood estimate for the weights of the bivariate chi-bar-squared distribution from sample data</li>
<li>
<code>estim_jags</code>, <code>estim_stan</code>: generate inputs for JAGS / Stan (data list and model string or external file) for sampling from the posterior distribution of the intrinsic volumes, given samples of the bivariate chi-bar-squared distribution</li>
</ul>
<p><strong>Usage:</strong> We use a sample from the bivariate chi-bar-squared distribution of a product of circular cones, for which we have exact formulas for its intrinsic volumes:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">v_true &lt;-<span class="st"> </span><span class="kw"><a href="reference/circ_ivols.html">circ_ivols</a></span>( <span class="kw">c</span>(<span class="dv">5</span>,<span class="dv">8</span>), <span class="kw">c</span>(<span class="fl">0.7</span>*pi/<span class="dv">2</span>, <span class="fl">0.8</span>*pi/<span class="dv">2</span>), <span class="dt">product=</span><span class="ot">TRUE</span>)
m_samp &lt;-<span class="st"> </span><span class="kw"><a href="reference/bichibarsq.html">rbichibarsq</a></span>(<span class="fl">1e5</span>, v_true)
d &lt;-<span class="st"> </span><span class="dv">13</span>
<span class="co"># scatter plot of the sample</span>
<span class="kw">ggplot</span>(<span class="kw">as_tibble</span>(m_samp), <span class="kw">aes</span>(V1,V2)) +<span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">alpha=</span>.<span class="dv">02</span>) +
<span class="st">    </span><span class="kw">theme_bw</span>() +
<span class="st">    </span><span class="kw">theme</span>(<span class="dt">axis.title.x=</span><span class="kw">element_blank</span>(),<span class="dt">axis.title.y=</span><span class="kw">element_blank</span>())</code></pre></div>
<p><img src="README_figures/ex-reconstr-1.png" width="768" style="display: block; margin: auto;"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># estimate the moments of the intrinsic volumes, compare with true values</span>
est &lt;-<span class="st"> </span><span class="kw"><a href="reference/estim_statdim_var.html">estim_statdim_var</a></span>(d, m_samp); est
<span class="co">#&gt; $delta</span>
<span class="co">#&gt; [1] 10.00653</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $var</span>
<span class="co">#&gt; [1] 2.89369</span>
<span class="kw">list</span>( <span class="dt">statdim_true=</span><span class="kw">sum</span>((<span class="dv">0</span>:d)*v_true),
      <span class="dt">var_true=</span><span class="kw">sum</span>((<span class="dv">0</span>:d)^<span class="dv">2</span>*v_true)-<span class="kw">sum</span>((<span class="dv">0</span>:d)*v_true)^<span class="dv">2</span> )
<span class="co">#&gt; $statdim_true</span>
<span class="co">#&gt; [1] 9.997038</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $var_true</span>
<span class="co">#&gt; [1] 2.651605</span>

<span class="co"># prepare data for computing log-likelihoods and for EM estimate</span>
data &lt;-<span class="st"> </span><span class="kw"><a href="reference/prepare_em.html">prepare_em</a></span>(d, m_samp)

<span class="co"># find initial estimates of intrinsic volumes based on moments</span>
v_init &lt;-<span class="st"> </span><span class="kw">tibble</span>( <span class="dt">v_est_0 =</span> <span class="kw"><a href="reference/init_ivols.html">init_ivols</a></span>(<span class="dv">13</span>,<span class="dv">0</span>),
                  <span class="dt">v_est_1 =</span> <span class="kw"><a href="reference/init_ivols.html">init_ivols</a></span>(<span class="dv">13</span>,<span class="dv">1</span>,est$delta,est$var),
                  <span class="dt">v_est_4 =</span> <span class="kw"><a href="reference/init_ivols.html">init_ivols</a></span>(<span class="dv">13</span>,<span class="dv">4</span>,est$delta,est$var) )

<span class="co"># compute log-likelihoods of initial estimates</span>
<span class="kw">lapply</span>( v_init, loglike_ivols, data, <span class="dv">0</span>)
<span class="co">#&gt; $v_est_0</span>
<span class="co">#&gt; [1] -5.482306</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $v_est_1</span>
<span class="co">#&gt; [1] -4.976301</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $v_est_4</span>
<span class="co">#&gt; [1] -4.979601</span>
<span class="co"># plot the different estimates and their logarithms</span>
tib_plot &lt;-<span class="st"> </span>v_init %&gt;%<span class="st"> </span><span class="kw">add_column</span>(<span class="dt">v_true=</span>v_true,<span class="dt">.before=</span><span class="dv">1</span>) %&gt;%
<span class="st">    </span><span class="kw">add_column</span>(<span class="dt">k=</span><span class="dv">0</span>:d,<span class="dt">.before=</span><span class="dv">1</span>) %&gt;%<span class="st"> </span><span class="kw">gather</span>(mode,value,<span class="dv">2</span>:<span class="dv">5</span>)
<span class="kw">ggplot</span>(tib_plot, <span class="kw">aes</span>(<span class="dt">x=</span>k, <span class="dt">y=</span>value, <span class="dt">color=</span>mode)) +
<span class="st">    </span><span class="kw">geom_line</span>() +<span class="st"> </span><span class="kw">theme_bw</span>()</code></pre></div>
<p><img src="README_figures/ex-reconstr-2.png" width="768" style="display: block; margin: auto;"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(tib_plot, <span class="kw">aes</span>(<span class="dt">x=</span>k, <span class="dt">y=</span><span class="kw">log</span>(value), <span class="dt">color=</span>mode)) +
<span class="st">    </span><span class="kw">geom_line</span>() +<span class="st"> </span><span class="kw">theme_bw</span>()</code></pre></div>
<p><img src="README_figures/ex-reconstr-3.png" width="768" style="display: block; margin: auto;"></p>
<p>We compute some iterates of the EM algorithm for different initial estimates:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">em0 &lt;-<span class="st"> </span><span class="kw"><a href="reference/estim_em.html">estim_em</a></span>( d, m_samp, <span class="dt">N=</span><span class="dv">200</span>, <span class="dt">init_mode=</span><span class="dv">0</span>, <span class="dt">data=</span>data)
em1 &lt;-<span class="st"> </span><span class="kw"><a href="reference/estim_em.html">estim_em</a></span>( d, m_samp, <span class="dt">N=</span><span class="dv">200</span>, <span class="dt">init_mode=</span><span class="dv">1</span>, <span class="dt">data=</span>data)
em4 &lt;-<span class="st"> </span><span class="kw"><a href="reference/estim_em.html">estim_em</a></span>( d, m_samp, <span class="dt">N=</span><span class="dv">200</span>, <span class="dt">init_mode=</span><span class="dv">4</span>, <span class="dt">data=</span>data)

<span class="co"># plotting some iterates of initial mode == 0, 1, 4</span>
tib_true &lt;-<span class="st"> </span><span class="kw">tibble</span>( <span class="dt">k=</span><span class="dv">0</span>:d, <span class="dt">v_true=</span>v_true )
tib_plot0 &lt;-<span class="st"> </span><span class="kw">as_tibble</span>( <span class="kw">t</span>(em0$iterates[<span class="dv">1+20</span>*(<span class="dv">0</span>:<span class="dv">10</span>), ]) ) %&gt;%
<span class="st">    </span><span class="kw">add_column</span>(<span class="dt">k=</span><span class="dv">0</span>:d,<span class="dt">.before=</span><span class="dv">1</span>) %&gt;%<span class="st"> </span><span class="kw">gather</span>(step,value,<span class="dv">2</span>:<span class="dv">12</span>)
<span class="kw">ggplot</span>(tib_plot0,<span class="kw">aes</span>(<span class="dt">x=</span>k,<span class="dt">y=</span>value,<span class="dt">color=</span>step)) +
<span class="st">    </span><span class="kw">geom_line</span>() +<span class="st"> </span><span class="kw">theme_bw</span>() +
<span class="st">    </span><span class="kw">geom_line</span>(<span class="dt">data=</span>tib_true,<span class="kw">aes</span>(<span class="dt">x=</span>k,<span class="dt">y=</span>v_true),<span class="dt">colour=</span><span class="st">"black"</span>,<span class="dt">linetype=</span><span class="st">"dashed"</span>) +
<span class="st">    </span><span class="kw">theme</span>(<span class="dt">legend.position=</span><span class="st">"none"</span>, <span class="dt">axis.title.x=</span><span class="kw">element_blank</span>(), <span class="dt">axis.title.y=</span><span class="kw">element_blank</span>())
<span class="co"># [...]</span></code></pre></div>
<!-- ```{r plot-em-iterates, echo=FALSE, fig.width=8, fig.height=5, fig.align="center"} -->
<!-- ggplot(tib_plot0,aes(x=k,y=log(value),color=step)) + -->
<!--     geom_line() + theme_bw() + -->
<!--     geom_line(data=tib_true,aes(x=k,y=log(v_true)),colour="black",linetype="dashed") + -->
<!--     theme(legend.position="none", axis.title.x=element_blank(), axis.title.y=element_blank()) -->
<!-- tib_plot1 <- as_tibble( t(em0$iterates[1+20*(0:10), ]) ) %>% -->
<!--     add_column(k=0:d,.before=1) %>% gather(step,value,2:12) -->
<!-- ggplot(tib_plot1,aes(x=k,y=value,color=step)) + -->
<!--     geom_line() + theme_bw() + -->
<!--     geom_line(data=tib_true,aes(x=k,y=v_true),colour="black",linetype="dashed") + -->
<!--     theme(legend.position="none", axis.title.x=element_blank(), axis.title.y=element_blank()) -->
<!-- ggplot(tib_plot1,aes(x=k,y=log(value),color=step)) + -->
<!--     geom_line() + theme_bw() + -->
<!--     geom_line(data=tib_true,aes(x=k,y=log(v_true)),colour="black",linetype="dashed") + -->
<!--     theme(legend.position="none", axis.title.x=element_blank(), axis.title.y=element_blank()) -->
<!-- tib_plot4 <- as_tibble( t(em0$iterates[1+20*(0:10), ]) ) %>% -->
<!--     add_column(k=0:d,.before=1) %>% gather(step,value,2:12) -->
<!-- ggplot(tib_plot4,aes(x=k,y=value,color=step)) + -->
<!--     geom_line() + theme_bw() + -->
<!--     geom_line(data=tib_true,aes(x=k,y=v_true),colour="black",linetype="dashed") + -->
<!--     theme(legend.position="none", axis.title.x=element_blank(), axis.title.y=element_blank()) -->
<!-- ggplot(tib_plot4,aes(x=k,y=log(value),color=step)) + -->
<!--     geom_line() + theme_bw() + -->
<!--     geom_line(data=tib_true,aes(x=k,y=log(v_true)),colour="black",linetype="dashed") + -->
<!--     theme(legend.position="none", axis.title.x=element_blank(), axis.title.y=element_blank()) -->
<!-- ``` -->
<p><img src="README_figures/save_ex-reconstr-comp-1.png" width="645" style="display: block; margin: auto;"><img src="README_figures/save_plot-em-iterates-1.png" width="737" style="display: block; margin: auto;"><img src="README_figures/save_plot-em-iterates-2.png" width="737" style="display: block; margin: auto;"><img src="README_figures/save_plot-em-iterates-3.png" width="737" style="display: block; margin: auto;"><img src="README_figures/save_plot-em-iterates-4.png" width="737" style="display: block; margin: auto;"><img src="README_figures/save_plot-em-iterates-5.png" width="737" style="display: block; margin: auto;"></p>
<p>We can see that the estimate after 200 iterations is quite accurate for the larger values, but still comparably poor for the smaller values. If we increase the sample size to 10^6, we can see that the algorithm converges well.</p>
<p><img src="README_figures/save_em-large-sample-1.png" width="737" style="display: block; margin: auto;"><img src="README_figures/save_em-large-sample-2.png" width="737" style="display: block; margin: auto;"></p>
<!-- saved the output of the R code below (takes a few minutes) -->
<!-- ```{r em-large-sample, fig.width=8, fig.height=5, fig.align="center"} -->
<!-- # obtain large sample -->
<!-- set.seed(1234) -->
<!-- m_samp_large <- rbichibarsq(1e6, v_true) -->
<!-- em <- estim_em( d, m_samp_large, N=200 ) -->
<!-- tib_plot <- as_tibble( t(em$iterates[1+20*(0:10), ]) ) %>% -->
<!--     add_column(k=0:d,.before=1) %>% gather(step,value,2:12) -->
<!-- ggplot(tib_plot,aes(x=k,y=value,color=step)) + -->
<!--     geom_line() + theme_bw() + -->
<!--     geom_line(data=tib_true,aes(x=k,y=v_true),colour="black",linetype="dashed") + -->
<!--     theme(legend.position="none", axis.title.x=element_blank(), axis.title.y=element_blank()) -->
<!-- ggplot(tib_plot,aes(x=k,y=log(value),color=step)) + -->
<!--     geom_line() + theme_bw() + -->
<!--     geom_line(data=tib_true,aes(x=k,y=log(v_true)),colour="black",linetype="dashed") + -->
<!--     theme(legend.position="none", axis.title.x=element_blank(), axis.title.y=element_blank()) -->
<!-- ``` -->
</div>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2 class="hasAnchor">
<a href="#sidebar" class="anchor"></a>Links</h2>
<ul class="list-unstyled">
<li>Browse source code at <br><a href="http://github.com/damelunx/conivol">http://​github.com/​damelunx/​conivol</a>
</li>
<li>Report a bug at <br><a href="https://github.com/damelunx/conivol/issues">https://​github.com/​damelunx/​conivol/​issues</a>
</li>
</ul>
<h2>License</h2>
<p><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></p>
<h2>Developers</h2>
<ul class="list-unstyled">
<li>Dennis Amelunxen <br><small class="roles"> Author, maintainer </small>  </li>
<li>Martin Lotz <br><small class="roles"> Author </small>  </li>
</ul>
</div>

</div>


      <footer><div class="copyright">
  <p>Developed by Dennis Amelunxen, Martin Lotz.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
